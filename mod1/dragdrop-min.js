var browserPos=null;var sortable_currentItem;function setFormValueOpenBrowser(e,t){var n=T3_TV_MOD1_BACKPATH+"browser.php?mode="+e+"&bparams="+t;browserWin=window.open(n,"templavoilareferencebrowser","height=350,width="+(e=="db"?650:600)+",status=0,menubar=0,resizable=1,scrollbars=1");browserWin.focus()}function setFormValueFromBrowseWin(e,t,n,r){if(t){var i=t.split("_");var s=i.pop();i=i.join("_");browserPos.href=browserPos.rel.replace("%23%23%23",i+":"+s);jumpToUrl(browserPos.href)}}function jumpToUrl(e){window.location.href=e;return false}function jumpExt(e,t){var n=t?t:"";window.location.href=e+(T3_THIS_LOCATION?"&returnUrl="+T3_THIS_LOCATION:"")+n;return false}function jumpSelf(e){window.location.href=e+(T3_RETURN_URL?"&returnUrl="+T3_RETURN_URL:"");return false}function setHighlight(e){top.fsMod.recentIds["web"]=e;top.fsMod.navFrameHighlightedID["web"]="pages"+e+"_"+top.fsMod.currentBank;if(top.content&&top.content.nav_frame&&top.content.nav_frame.refresh_nav){top.content.nav_frame.refresh_nav()}}function editRecords(e,t,n,r){window.location.href=T3_TV_MOD1_BACKPATH+"alt_doc.php?returnUrl="+T3_TV_MOD1_RETURNURL+"&edit["+e+"]["+t+"]=edit"+n}function editList(e,t){var n="";var r=0;var i=t.indexOf(",");while(i!=-1){if(cbValue(e+"|"+t.substr(r,i-r))){n+=t.substr(r,i-r)+","}r=i+1;i=t.indexOf(",",r)}if(cbValue(e+"|"+t.substr(r))){n+=t.substr(r)+","}return n?n:t}function sortable_unhideRecord(e,t){jumpToUrl(t)}function sortable_hideRecord(e,t){if(!sortable_removeHidden)return jumpToUrl(t);while(typeof e.className=="undefined"||e.className.search(/tpm-element(?!-)/)==-1){e=e.parentNode}new Ajax.Request(t);new Effect.Fade(e,{duration:.5,afterFinish:sortable_hideRecordCallBack})}function sortable_hideRecordCallBack(e){var t=e.element;while(t.lastChild)t.removeChild(t.lastChild)}function sortable_unlinkRecordCallBack(e){var t=e.element;var n=t.parentNode;n.removeChild(t);sortable_update(n)}function sortable_unlinkRecord(e,t,n){new Ajax.Request("index.php?"+sortable_linkParameters+"&ajaxUnlinkRecord="+escape(e),{onSuccess:function(e){var t=Builder.build(e.responseText);$("tx_templavoila_mod1_sidebar-bar").setStyle({height:$("tx_templavoila_mod1_sidebar-bar").getHeight()+"px"});$("tx_templavoila_mod1_sidebar-bar").innerHTML=t.innerHTML;setTimeout(function(){sortable_unlinkRecordSidebarCallBack(n)},100)}});new Effect.Fade(t,{duration:.5,afterFinish:sortable_unlinkRecordCallBack})}function sortable_unlinkRecordSidebarCallBack(e){var t=$("tx_templavoila_mod1_sidebar-bar").childElements();var n=0;for(var r=0;r<t.length;r++){n+=t[r].getHeight()}$("tx_templavoila_mod1_sidebar-bar").morph({height:n+"px"},{duration:.1,afterFinish:function(){$("tx_templavoila_mod1_sidebar-bar").setStyle({height:"auto"});if(e&&$(e)){$(e).highlight()}}})}function sortable_updateItemButtons(e,t,n){var r=[],i=[];var s=escape(n+t);e.childElements().each(function(e){if(e.nodeName=="A"&&e.href){switch(e.className){case"tpm-new":e.href=e.href.replace(/&parentRecord=[^&]+/,"&parentRecord="+s);break;case"tpm-browse":if(e.rel){e.rel=e.rel.replace(/&destination=[^&]+/,"&destination="+s)}break;case"tpm-delete":e.href=e.href.replace(/&deleteRecord=[^&]+/,"&deleteRecord="+s);break;case"tpm-unlink":e.href=e.href.replace(/unlinkRecord\('[^']+'/,"unlinkRecord('"+s+"'");break;case"tpm-cut":case"tpm-copy":case"tpm-ref":e.href=e.href.replace(/CB\[el\]\[([^\]]+)\]=[^&]+/,"CB[el][$1]="+s);break;case"tpm-pasteAfter":case"tpm-pasteSubRef":e.href=e.href.replace(/&destination=[^&]+/,"&destination="+s);break;case"tpm-makeLocal":e.href=e.href.replace(/&makeLocalRecord=[^&]+/,"&makeLocalRecord="+s);break}}else if(e.childElements()&&e.className!="tpm-subelement-table"){sortable_updateItemButtons(e,t,n)}})}function sortable_update(e){var t=e.firstChild;var n=1;while(t!=null){if(!(typeof t.className=="undefined")&&t.className.search(/tpm-element(?!-)/)>-1){if(sortable_currentItem&&t.id==sortable_currentItem.id){var r=T3_TV_MOD1_BACKPATH+"ajax.php?ajaxID=tx_templavoila_mod1_ajax::moveRecord&source="+all_items[sortable_currentItem.id]+"&destination="+all_items[e.id]+(n-1);var i=new Ext.LoadMask(Ext.getBody(),{msg:""});i.show();Ext.select(".ext-el-mask").setStyle("background-color","#f8f8f8");new Ajax.Request(r,{onComplete:function(e){i.hide()}});sortable_currentItem=false}sortable_updateItemButtons(t,n,all_items[e.id]);all_items[t.id]=all_items[e.id]+n;n++}t=t.nextSibling}}function sortable_change(e){sortable_currentItem=e}function deleteRecordWithLoader(e){var t=confirm(e);if(t){var n=new Ext.LoadMask(Ext.getBody(),{msg:""});n.show();Ext.select(".ext-el-mask").setStyle("background-color","#f8f8f8");return true}return false}function tv_createSortable(e,t){if($(e)){Position.includeScrollOffsets=true;Position.prepare();Sortable.create(e,{tag:"div",ghosting:false,format:/(.*)/,handle:"sortable_handle",scroll:"typo3-docbody",scrollSpeed:30,dropOnEmpty:true,constraint:false,containment:t,onChange:sortable_change,onUpdate:sortable_update})}}